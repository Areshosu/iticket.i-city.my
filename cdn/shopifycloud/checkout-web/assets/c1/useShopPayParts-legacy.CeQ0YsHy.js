!function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function t(t){for(var s=1;s<arguments.length;s++){var i=null!=arguments[s]?arguments[s]:{};s%2?e(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t,n,s,i,a,l){try{var r=e[a](l),o=r.value}catch(e){return void n(e)}r.done?t(o):Promise.resolve(o).then(s,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var l=e.apply(t,n);function r(e){s(l,i,a,r,o,"next",e)}function o(e){s(l,i,a,r,o,"throw",e)}r(void 0)}))}}System.register(["./app-legacy.CVtZXpP_.js","./useShopPayPaymentRequiredMethod-legacy.DC5RFglA.js","./flags-legacy.62tGmLT2.js","./useShopPaySessionTokenStorage-legacy.C9z0D7nF.js"],(function(e,n){"use strict";var s,a,l,r,o,d,u,p,c,m,y,h,v,f,g,A,S,b,P,_,C,M,w,I,U,k,O,D,x,R,j,F,N,L,E,B,q,V,Y,$,T,z,H,G,Z,K,J,Q,W,X,ee,te,ne,se,ie,ae,le,re,oe,de,ue,pe,ce,me;return{setters:[e=>{s=e.gx,a=e.gy,l=e.i,r=e.z,o=e.eP,d=e.B,u=e.ga,p=e.aF,c=e.g8,m=e.bb,y=e.aN,h=e.gz,v=e.gv,f=e.gA,g=e.gB,A=e.eb,S=e.gC,b=e.gD,P=e.gE,_=e.eZ,C=e.s,M=e.gF,w=e.gG,I=e.b2,U=e.gH,k=e.n,O=e.eg,D=e.f3,x=e.bZ,R=e.gI,j=e.gJ,F=e.gK,N=e.gL,L=e.gM,E=e.gN,B=e.cR,q=e.D,V=e.gO,Y=e.gP,$=e.k,T=e.gQ,z=e.gR,H=e.go,G=e.gS,Z=e.gT,K=e.gU,J=e.L,Q=e.f5,W=e.gV,X=e.gW,ee=e.gX,te=e.gY,ne=e.em,se=e.gZ,ie=e.g_,ae=e.ei,le=e.g$,re=e.h0},e=>{oe=e.a,de=e.b,ue=e.u},e=>{pe=e.u,ce=e.F},e=>{me=e.b}],execute:function(){e("u",(function(){const{data:e,loading:ve,refetchBuyerDetails:fe}=function(){const e=oe(),{telemetryClient:t,source:{checkoutSessionIdentifier:C},shop:{myshopifyDomain:M,id:w},shopPay:{isSimulated:I}}=l(),{redirect_source:U}=d(),k=u(),O=function(){const e=s(a),t=e.parts.shippingAddress.value,n=e.parts.email.value,{telemetryClient:i}=l();return r((()=>{const e=`${Date.now()}`;if(!t)return i.leaveErrorBreadcrumb("No address info found for shop pay simulated checkout"),{status:"failed"};const s={firstName:t.firstName,lastName:t.lastName,company:t.company,address1:t.address1,address2:t.address2,city:t.city,countryCode:t.countryCode,zoneCode:t.zoneCode,postalCode:t.postalCode,phone:t.phone},a=t.countryCode||"AC",l={id:"cc1",brand:"Visa",expired:!1,expiring:!1,expiryMonth:12,expiryYear:(new Date).getFullYear()+2,lastDigits:"4242",lastUsedAt:e,name:"Sample Card",supportsInstallmentsSplitPayLoan:!1,supportsInstallmentsInterestLoan:!1,funding:"credit",billingAddress:{address:s},billingAddressValid:!0,installmentsSplitPayLoanNotSupportedReason:null,installmentsInterestLoanNotSupportedReason:null};return{flow:"authenticated_user",publicId:"FakeUser",status:"success",email:n||"",phone:s.phone||"",phoneCountryCode:a,shopAccountUuid:o(),emailForSignUp:"",wallet:{},newUser:!1,sessionVerified:!0,sessionAuthenticationMethod:"sms",installmentsRejected:!1,installmentsRetryable:!1,addresses:[{id:"address1",lastUsedAt:`${Date.now()}`,requiresVerification:!1,valid:!0,userPreferred:!1,address:s}],creditCards:[l],paymentMethods:[],enabledFlags:[],installmentsPrequalifiedAmount:null,installmentCredential:null,experiments:[],spiServiceAvailable:!0,paymentMethodImport:null}}),[])}(),[D,x]=p(),[R,j]=p(!0),{sessionStorageEmail:F,clearEmailOnlySignUp:N}=c(),L="undefined"==typeof window,E=I,{data:B,error:q,loading:V,refetch:Y}=me(n,{variables:{checkoutContextInput:{checkoutVersion:e,checkoutIdentifier:null!=C?C:"unknown",shopifyDomain:M,shopId:m(w)},shopifyDomain:M,redirectSource:U},skip:E});function $(){I?(x(O()),j(!1)):function(){var e,t,n;if(!k)return;if(j(!0),V)return;if(h(q))return v.includes(k)?r():F?r(F):x({status:"failed",errors:[{field:[],message:f}]}),void j(!1);if(q||null==B||null==B.checkoutSession||null==B.checkoutSession.user||null==B.checkoutSession.session)return x({status:"failed"}),void j(!1);const{session:s,user:i,secureData:a,spiServiceAvailable:l}=B.checkoutSession;function r(e=""){x({status:"success",flow:e?"email_only_signup":"unauthenticated_user",addresses:[],creditCards:[],paymentMethods:[],wallet:{},email:e,publicId:"",phone:"",phoneCountryCode:"US",installmentsRejected:!1,installmentsRetryable:!1,preselectSpi:void 0,sessionVerified:!1,sessionAuthenticationMethod:null,newUser:!0,shopAccountUuid:"",emailForSignUp:e,enabledFlags:[],installmentsPrequalifiedAmount:null,installmentCredential:null,experiments:[],spiServiceAvailable:!0,paymentMethodImport:null})}x({status:"success",flow:"authenticated_user",addresses:i.addresses.map(_),creditCards:i.paymentMethods.filter(b).map(P),paymentMethods:S(i.paymentMethods),wallet:i.wallet,email:i.email,publicId:i.publicId,phone:i.phone,phoneCountryCode:i.phoneCountryCode,installmentsRejected:i.installmentsRejected,installmentsRetryable:!1,preselectSpi:i.preselectSpiForReturningBuyer?A.ReturningSpiBuyer:void 0,sessionVerified:s.verified,sessionAuthenticationMethod:null!==(e=s.authenticationMethod)&&void 0!==e?e:null,newUser:i.newUser,shopAccountUuid:i.shopAccountUuid,emailForSignUp:"",enabledFlags:i.enabledFlags,secureData:null!=a?a:void 0,installmentsPrequalifiedAmount:g(i.installmentsPrequalification),installmentCredential:null!==(t=i.installmentCredential)&&void 0!==t?t:null,experiments:i.experiments,spiServiceAvailable:l,paymentMethodImport:null!==(n=i.paymentMethodImport)&&void 0!==n?n:null}),F&&N(),j(!1)}()}y($,[B,q,V,w,I,F,O,N,k,t]),L&&$();return{loading:R,data:D,refetchBuyerDetails:r(i((function*(){j(!0),yield Y(),j(!1)})),[Y])}}(),[ge,Ae]=p(),Se=k(),be=de(),Pe=O(),_e=ue(),{updateCheckoutAddress:Ce}=D(),Me=x(),we=Se.shippingAddress.value,{persistedShippingAddressId:Ie,persistedUserSelectedPaymentMethod:Ue,persistedPaymentMethod:ke}=function(){const{persistence:e}=l(),t=C.loading,n=C.selectedShippingAddress,s=C.paymentMethodOption,i=C.selectedPaymentMethod,a=null==e?void 0:e.get(M.ShopPay,{scope:w});return I((()=>{var l;if(t.value)return;const r={selectedShippingAddressId:null===(l=n.value)||void 0===l?void 0:l.id,selectedPaymentMethodOption:s.value,userSelectedPaymentMethod:i.value};U(a,r)||ye(r)||null==e||e.createUpdate(M.ShopPay,{scope:w})(r)})),{persistedShippingAddressId:null==a?void 0:a.selectedShippingAddressId,persistedUserSelectedPaymentMethod:null==a?void 0:a.userSelectedPaymentMethod,persistedPaymentMethod:null==a?void 0:a.selectedPaymentMethodOption}}(),Oe=R(),De=pe("shipping"),[,xe]=j({allowPreselect:!1}),{monorail:Re,source:je,checkout:Fe,checkout:{latestReceipt:Ne},shop:Le,telemetryClient:Ee,persistence:Be,shopPay:qe}=l(),{accountSwitchState:Ve}=qe,Ye=F(),$e=N();C.storedCreditCards=L((()=>C.userStoredPaymentMethods.value.filter((e=>E(e)))));const{value:Te}=B(),ze=!q(V),He=Y(Te),Ge=$((()=>{const e=["ideal","bogus_app_coin"];return ze&&e.push("usdc"),e}),[ze]);Ne&&T(Ne)&&Be&&z(Be);const Ze=r((e=>{if(null==Te||!Te.length)return[];const n=he.filter((e=>Ge.includes(e)));return Te.reduce(((s,i)=>{if("customOnsite"===i.type)for(const t of n){var a,l;if(i.paymentBrands.includes(t))return[...s,{id:t,paymentMethod:"CUSTOM_ONSITE",paymentBrands:i.paymentBrands,lastUsedAt:null!==(a=null===(l=e.find((e=>e.paymentMethod.toLowerCase()===t)))||void 0===l?void 0:l.lastUsedAt)&&void 0!==a?a:null}]}else{var r,o,d,u;if("local"===i.type&&"IDEAL"===i.name)return[...s,t(t({},le),{},{lastUsedAt:null!==(r=null===(o=e.find((e=>"IDEAL"===e.paymentMethod)))||void 0===o?void 0:o.lastUsedAt)&&void 0!==r?r:null})];if(Oe&&re(i))return[...s,{id:"wallet-apple_pay",paymentMethod:"APPLE_PAY",lastUsedAt:null!==(d=null===(u=e.find((e=>"APPLE_PAY"===e.paymentMethod)))||void 0===u?void 0:u.lastUsedAt)&&void 0!==d?d:null}]}return s}),[])}),[Ge,Te,Oe]);function Ke(e){return Je.apply(this,arguments)}function Je(){return(Je=i((function*(e){var n,s;const{flow:i,email:a,phone:l,phoneCountryCode:r,creditCards:o,paymentMethods:d,wallet:u,sessionVerified:p,sessionAuthenticationMethod:c,addresses:m,installmentsRejected:y,installmentsRetryable:h,preselectSpi:v,newUser:f,publicId:g,shopAccountUuid:A,emailForSignUp:S,enabledFlags:b,secureData:P,installmentsPrequalifiedAmount:_,installmentCredential:M,experiments:w,spiServiceAvailable:I,paymentMethodImport:U}=e,k=Ze(d),O=De(m),D=G(k,o),x=null==d?void 0:d.map((e=>"IDEAL"===e.paymentMethod?{paymentMethod:"IDEAL",lastUsedAt:e.lastUsedAt}:Oe&&"APPLE_PAY"===e.paymentMethod?{paymentMethod:"APPLE_PAY",lastUsedAt:e.lastUsedAt}:{paymentMethod:"CUSTOM_ONSITE",paymentBrand:e.paymentMethod.toLowerCase(),lastUsedAt:e.lastUsedAt})).sort(Z),R=ae({paymentRequiredMethod:_e,isIdealEnabledForShopPay:Pe});if(b.includes(ce)&&0===o.length)return void Ae({status:"failed"});const j=K(we,["firstName","lastName","company","address1","address2","city","phone","postalCode","streetName","streetNumber","neighborhood","line2"]),F=j?null:null===(n=m.find((e=>J(e.address,we)))||(null==O?void 0:O.find((({address:e})=>J(e,we)))))||void 0===n?void 0:n.id,N=!j&&F?X(we,F):void 0,L="IN_PROGRESS"===(null==U?void 0:U.status)?[]:m;qe.unstable_updateFlow(i),C.phoneNumber.value=l,C.phoneCountryCode.value=r,C.userStoredPaymentMethods.value=D,C.paymentMethodHistory.value=x,C.wallet.value=u,C.addresses.value=L,C.paymentMethodOption.value=ke||C.paymentMethodOption.value||{type:"wallet",name:"SHOP_PAY"},C.installmentsRejected.value=y,C.installmentsRetryable.value=h,C.preselectSpi.value=v,C.newUser.value=f,C.publicId.value=g,C.email.value=a,C.shopAccountUuid.value=A,C.emailForSignUp.value=S,C.enabledFlags.value=b,C.secureData.value=P,C.installmentsPrequalifiedAmount.value=_,C.installmentCredential.value=M,C.experiments.value=w,C.spiServiceAvailable.value=I,C.paymentMethodImport.value=U,null!=Me&&Me.email&&a!==Me.email?Se.email.value=Me.email:null!=Me&&Me.email||null==Me||!Me.phone?a&&(Se.email.value=a):(Se.email.value="",Se.phone.value=Me.phone),"authenticated_user"!==i&&(C.signUpPhoneNumber.value=""),C.sessionVerified.value=p,C.sessionAuthenticationMethod.value=c;const B={},q=Q(L),V=W(L);V&&(C.explicitlyPreferredShippingAddressId.value=V.id);const Y=O?[...L,...O.map((({address:e,id:t})=>X(e,t)))]:L,$=e=>Y.find((t=>t.id===e)),T=Ie?$(Ie)||$(ie):null,z=Ie?L.find((e=>e.id===Ie)):null,H=("IN_PROGRESS"===(null===(s=C.paymentMethodImport.value)||void 0===s?void 0:s.status)?[]:[T,N,q]).find(Ye),le=z||q;if($e&&H&&(C.selectedShippingAddress.value=H,B.shippingAddress=H.address),le&&(C.selectedFreeCheckoutBillingAddress.value=le,C.selectedNewCardBillingAddress.value=le,C.selectedLPMBillingAddress.value=le,R&&(B.billingAddress=le.address),be&&(B.billingAddress=le.address)),C.storedCreditCards.value.length){let e=null;const n=Ue||D[0]||null;if(e="IDEAL"===_e?Ue||ee(D):Ue&&te(D,Ue.id)||ee(D),e)if(n&&E(n)&&n.paymentAttributes.expired&&e.id!==n.id&&Re.record({schemaId:"shopify_pay_payment_page_ui_interaction/1.1",payload:t(t({},ne(je,Fe,Le)),{},{action:"expired_card_preselect_prevented"})}),se({shopPayParts:C,paymentMethod:e,setPaymentLine:xe,negotiatedPaymentMethods:Te,telemetryClient:Ee}),E(e)){if(!be&&!R){const t=e.paymentAttributes.billingAddress.address;B.billingAddress=t}}else le&&(B.billingAddress=le.address)}B.fallbackPhoneNumber=l,Ce(B,!0),Ae({status:"success"}),C.loading.value=!1}))).apply(this,arguments)}const Qe="undefined"==typeof window;return y((()=>{"failed"!==(null==Ne?void 0:Ne.status)||Qe||fe()}),[null==Ne?void 0:Ne.status,fe,Qe]),y((()=>{if(Ve!==H.Acknowledged)return;let e=!1;const t=function(){var t=i((function*(){try{yield fe()}finally{e||(qe.updateHasSwitchedAccounts(!1),qe.resetAccountSwitchAcknowledgement())}}));return function(){return t.apply(this,arguments)}}();return t(),()=>{e=!0}}),[Ve,fe,qe]),y((()=>ve?(Ae({status:"loading"}),void(C.loading.value=!0)):e&&"failed"!==e.status?void Ke(e):(Ae({status:"failed",errors:null==e?void 0:e.errors}),void(C.loading.value=!1))),[ve,e]),y((()=>{if(e&&"success"===e.status&&e.creditCards.length>0){var t;const n=null==Te?void 0:Te.map((e=>e.type)),s=null===(t=He.value)||void 0===t?void 0:t.map((e=>e.type));if(n&&s&&!n.every((e=>s.includes(e)))){He.value=Te;const t=Ze(e.paymentMethods),n=G(t,e.creditCards);C.selectedPaymentMethod.value=n[0]}}}),[Ze,e,Te,He]),Qe&&e&&"success"===e.status&&Ke(e),{shopPayParts:C,status:null==ge?void 0:ge.status,errors:null==ge?void 0:ge.errors,refetchBuyerDetails:fe}})),e("f","/cdn/shopifycloud/checkout-web/assets/c1/assets/shop_pay_favicon.KxBVC8uh.png");const n={id:"1924841e5824febdc2ca97960886a95444e62cc751a4cd2b68a3626013e974ea",type:"query",name:"ShopPayCheckoutSession",source:"query ShopPayCheckoutSession($checkoutContextInput:CheckoutContextInput!,$shopifyDomain:String!,$redirectSource:String){checkoutSession(checkoutContextInput:$checkoutContextInput redirectSource:$redirectSource){user{publicId email phone phoneCountryCode addresses{...ShippingAddressFragment __typename}paymentMethods{...on CreditCard{...CreditCardFragment __typename}...on PaymentMethod{id paymentMethod paymentAttributes lastUsedAt __typename}__typename}wallet{latestDiscount(shopifyDomain:$shopifyDomain){id shopifyDomain code redeemedAt __typename}__typename}installmentsRejected preselectSpiForReturningBuyer newUser shopAccountUuid enabledFlags installmentsPrequalification{prequalifiedAmount{value currency __typename}expiredAt __typename}installmentCredential{outcome requiresAdditionalInformation countryCode newUser __typename}paymentMethodImport{...on PaymentMethodShareImportPolling{status pollingDelay __typename}...on PaymentMethodShareImportProcessed{status __typename}__typename}experiments __typename}session{verified authenticationMethod __typename}secureData spiServiceAvailable __typename}}fragment ShippingAddressFragment on Address{fields{key value __typename}id lastUsedAt requiresVerification valid userPreferred explicitlyPreferred __typename}fragment CreditCardFragment on CreditCard{bank brand expired expiring expiryMonth expiryYear funding id lastDigits lastUsedAt name nickname supportsInstallmentsInterestLoan supportsInstallmentsSplitPayLoan installmentsInterestLoanNotSupportedReason installmentsSplitPayLoanNotSupportedReason billingAddressValid billingAddress{fields{key value __typename}__typename}__typename}"},ye=e=>Object.values(e).every((e=>!e)),he=["usdc","bogus_app_coin","ideal"]}}}))}();

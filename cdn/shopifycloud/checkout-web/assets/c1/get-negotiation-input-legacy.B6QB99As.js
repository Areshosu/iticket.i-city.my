!function(){const e=["deliveryLines"];function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}System.register(["./app-legacy.CVtZXpP_.js"],(function(t,r){"use strict";var o,s,a,l,d,u,p,c,m,y,v,h,g,b,f,A,P,M,S,k,I,T,C,x,_,L,D,j,E,w,O,B,N,R,F,V,U,q,Y,z,H,G,J,Q,X,W,$,K;return{setters:[e=>{o=e.j8,s=e.j9,a=e.ja,l=e.jb,d=e.w,u=e.L,p=e.jc,c=e.jd,m=e.je,y=e.fI,v=e.iN,h=e.jf,g=e.jg,b=e.jh,f=e.ji,A=e.jj,P=e.s,M=e.jk,S=e.jl,k=e.jm,I=e.jn,T=e.jo,C=e.jp,x=e.jq,_=e.jr,L=e.js,D=e.jt,j=e.ju,E=e.jv,w=e.jw,O=e.jx,B=e.jy,N=e.jz,R=e.jA,F=e.jB,V=e.jC,U=e.jD,q=e.jE,Y=e.jF,z=e.jG,H=e.jH,G=e.jI,J=e.jJ,Q=e.jK,X=e.bN,W=e.iJ,$=e.jL,K=e.jM}],execute:function(){t({g:function(t,{isCompleting:i=!1,customizeNegotiation:r,telemetryClient:o}={}){var s,a,l,d,Y,z,X,W,Z,ee,ge,be,fe,Ae,Pe,Me,Se,ke,Ie,Te,Ce;if(!t.sessionToken)throw new se("No session token");const{context:xe,parts:_e,throttle:Le,checkpoint:De}=t,{attributes:je,email:Ee,phoneNumber:we,acceptEmailMarketing:Oe,acceptSmsMarketing:Be,smsMarketingPhone:Ne,purchaseOrderNumber:Re,acceptPaymentVaulting:Fe,shopPayArtifact:Ve,shopPayRememberMeVisible:Ue,optionalDuties:qe,captcha:Ye,shippingAddress:ze,billingAddress:He,availableRedeemables:Ge,attribution:Je,saleAttributions:Qe,reduction:Xe,proposedDeliveryLines:We,externalDeliveryIds:$e,discountLines:Ke,merchandiseLines:Ze,locationAddress:et,useProgressiveRates:tt,interfaceFlow:nt,tipLines:it,alternativePaymentCurrency:rt,note:ot,rememberMe:st,cartMetafields:at,memberships:lt}=function(e){const t=e.email.peek().trim(),n=e.phone.peek().trim(),i=e.acceptEmailMarketing.peek(),r=e.acceptSmsMarketing.peek(),o=e.smsMarketingPhone.peek(),s=e.purchaseOrderNumber.peek(),a=e.acceptPaymentVaulting.peek(),l=e.shopPayArtifact.peek(),d=e.optionalDuties.peek(),u=e.captcha.peek(),p=e.shippingAddress.peek(),c=e.billingAddress.peek(),m=e.availableRedeemables.peek(),y=e.attribution.peek(),v=e.saleAttributions.peek(),h=e.reduction.peek(),g=e.deliveryLines.peek(),b=e.externalDeliveryIds.peek(),f=e.discountLines.peek(),A=e.merchandiseLines.peek(),P=e.locationAddress.peek(),M=e.useProgressiveRates.peek(),S=e.interfaceFlow.peek(),k=e.tipLines.peek(),I=e.note.peek(),T=e.attributes.peek(),C=e.cartMetafields.peek(),x=e.memberships.peek();return{attributes:T,email:t,phoneNumber:n,acceptEmailMarketing:i,acceptSmsMarketing:r,smsMarketingPhone:o,purchaseOrderNumber:s,acceptPaymentVaulting:a,shopPayArtifact:l,optionalDuties:d,captcha:u,shippingAddress:p,billingAddress:c,availableRedeemables:m,attribution:y,saleAttributions:v,reduction:h,proposedDeliveryLines:g,externalDeliveryIds:b,discountLines:f,merchandiseLines:A,locationAddress:P,useProgressiveRates:M,interfaceFlow:S,tipLines:k,note:I,alternativePaymentCurrency:e.alternativePaymentCurrency.peek(),rememberMe:e.rememberMe.peek(),shopPayRememberMeVisible:e.shopPayRememberMeVisible.peek(),cartMetafields:C,memberships:x}}(_e);let dt=_e.paymentLines.peek();const ut=null===(s=dt[0])||void 0===s?void 0:s.method,pt=!t.context.enabledFlags.includes(y),ct=le(t,pt,o);if(i&&null!=Ve&&Ve.shopUser&&he(ut,t.current.fields.paymentMethods.peek())){const e=ve(ut)?ut:function(e){const t=e.find((e=>H(e)));return G(t,["ideal"])?{type:"customOnsite",paymentMethodIdentifier:t.paymentMethodIdentifier,name:"iDEAL",paymentBrands:["ideal"]}:{type:"local",paymentMethodIdentifier:t.paymentMethodIdentifier,name:"IDEAL"}}(t.current.fields.paymentMethods.peek());dt=v(dt,function({paymentMethod:e,billingAddress:t}){const n=m(t);return{method:{type:"wallet",name:"SHOP_PAY",walletContent:"local"===e.type?J({paymentMethodIdentifier:e.paymentMethodIdentifier,billingAddress:n,selectedLPMBillingAddress:P.selectedLPMBillingAddress.value}):Q({billingAddress:n,paymentMethodIdentifier:e.paymentMethodIdentifier||"",paymentAttributes:e.paymentAttributes})}}}({paymentMethod:e,billingAddress:ct}))}const mt=t.current.peek(),yt=mt.shippingAddress,vt=null===(a=mt.contactInfo)||void 0===a?void 0:a.email,ht=(null===(l=mt.merchandiseLines)||void 0===l||null===(l=l.lines)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.totalPrice.currencyCode)||(null===(d=mt.buyerIdentity)||void 0===d?void 0:d.presentmentCurrency),gt=h(Ze,ht),bt=g(gt),ft=Boolean(null===(Y=b(mt))||void 0===Y?void 0:Y.amount),At=!yt||!f(ze,yt,["phone"]);At&&null!=yt&&yt.oneTimeUse&&(ze.oneTimeUse=!1);const Pt=i&&1===dt.length&&"wallet"===dt[0].method.type&&("APPLE_PAY"===dt[0].method.name||"GOOGLE_PAY"===dt[0].method.name),{proposedTotalAmount:Mt,proposedTotalIncludedAmount:St,proposedMixedStateTotalAmount:kt}=A(mt.taxes,mt.duties,{useIntervalForTaxAndPayment:Pt}),It=function({proposedTotalAmount:e,proposedTotalIncludedAmount:t,proposedMixedStateTotalAmount:n}){return{amount:ue(e),includedAmount:ue(t),mixedState:n?{amount:ue(null==n?void 0:n.proposedTotalAmount),includedAmount:ue(null==n?void 0:n.proposedTotalIncludedAmount)}:void 0}}({proposedTotalAmount:Mt,proposedTotalIncludedAmount:St,proposedMixedStateTotalAmount:kt}),Tt=null!==(z=null===(X=mt.allViolations)||void 0===X?void 0:X.map((e=>e.code)))&&void 0!==z?z:[],Ct=Tt.includes("TAX_NEW_TAX_MUST_BE_ACCEPTED"),xt=Tt.includes("PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT"),_t=null!==(W=null===(Z=mt.taxes)||void 0===Z?void 0:Z.status)&&void 0!==W?W:"missing";o&&i&&function(e,t){if(t.mixedState){const n=t.mixedState.amount,i=t.mixedState.includedAmount;if("available_total"===e)return"value"!==n.type&&"interval"!==n.type||pe(n.amount);if("available_total_included"===e)return"value"!==i.type&&"interval"!==i.type||pe(i.amount)}if("available_total"===e)return"value"!==t.amount.type&&"interval"!==t.amount.type||pe(t.amount.amount);if("available_total_included"===e){var n;const e="none"===t.includedAmount.type?null===(n=t.mixedState)||void 0===n?void 0:n.includedAmount:t.includedAmount;return!e||"value"!==e.type||pe(e.amount)}return!0}(_t,It)&&o.log("shop_pay_installments_tax_terms_missing_on_negotiation","[Negotiate] Completing without accepted tax terms",{hasTaxViolation:Ct,hasPaymentAmountViolation:xt,taxProposalSummary:It,taxes:mt.taxes,installmentsPaymentSet:Boolean(P.installmentsPayment.value),violationCodes:Tt});const Lt=M(null===(ee=mt.remoteTaxDetails)||void 0===ee?void 0:ee.perShopTaxes),Dt=null===(ge=mt.buyerIdentity)||void 0===ge?void 0:ge.customerProfile,jt=S(Dt),Et=k(_e),wt=function({acceptEmailMarketing:e,acceptSmsMarketing:t,smsMarketingPhone:n,smsMarketingCountryCode:i,email:r,isBusinessCustomer:o}){const s=[];return o||(n&&t&&s.push({sms:{value:n,countryCode:i}}),r&&e&&s.push({email:{value:r}})),s}({acceptEmailMarketing:Oe,acceptSmsMarketing:Be,smsMarketingPhone:Ne,smsMarketingCountryCode:Et,email:Ee,isBusinessCustomer:jt}),Ot=I(null===(be=mt.merchandiseLines)||void 0===be?void 0:be.lines),Bt=T(null===(fe=mt.merchandiseLines)||void 0===fe?void 0:fe.lines).some((e=>{var t;return null===(t=e.sellingPlan)||void 0===t?void 0:t.isFixed})),Nt=null!==(Ae=mt.canUpdateDiscountCodes)&&void 0!==Ae&&Ae,Rt=C({customAttributes:mt.customAttributes}),Ft=x({customAttributes:mt.customAttributes}),Vt=Rt&&Boolean(ze)&&Ft,Ut=P.secureData.peek(),qt="draftOrder"===(null===(Pe=t.source)||void 0===Pe?void 0:Pe.type),Yt=lt?function(e,t,n){if("filled"!==e.status)return{memberships:[],violations:[]};const i=function(e,t,n){const i=$(t);return e.cachedMembershipViolations.value.filter((e=>K(e,n,i)))}(t,e,n),r=i.map((e=>e.handle));return{memberships:e.memberships.map((e=>{const t=!r.includes(e.handle);return{handle:e.handle,apply:!!t&&e.apply}})),violations:i}}(lt,t.context,ze):void 0;t.context.cachedMembershipViolations.value=(null==Yt?void 0:Yt.violations)||[];const zt=function(e){return{memberships:e.map((e=>({handle:e.handle,apply:e.apply})))}}((null==Yt?void 0:Yt.memberships)||[]),Ht=m(ct),Gt=_(dt,ct,_e.billingAddressOption.peek()),Jt=null==Gt?void 0:Gt.streetAddress;if(Jt&&Ht){const e=["address1","city","countryCode","postalCode"].filter((e=>Ht[e]!==Jt[e]));e.length>0&&(null==o||o.log("get_negotiation_input_billing_address_mismatch_detected","Billing address mismatch detected between payment lines and billing address inputs",{mismatchedFields:e,paymentLinesBillingAddress:Ht,billingAddress:Jt,billingAddressOption:_e.billingAddressOption.peek()}))}if(i&&o){var Qt,Xt;const e=null===(Qt=mt.paymentMethods)||void 0===Qt?void 0:Qt.map((e=>"direct"===e.type?{paymentMethodIdentifier:e.paymentMethodIdentifier,name:e.name}:void 0)).filter(Boolean),t=null===(Xt=dt.find((e=>Boolean("direct"===e.method.type&&e.method.creditCardLastFourDigits&&e.method.brand))))||void 0===Xt?void 0:Xt.method.paymentMethodIdentifier;"US"!==ze.countryCode||!t||null!=e&&e.some((e=>(null==e?void 0:e.paymentMethodIdentifier)===t))||null==o||o.error(new ye("Completing with a direct payment line mismatch with seller proposal available payment methods"),{metadata:{value:{buyerDirectPaymentMethodIdentifiers:JSON.stringify(t),availableDirectPaymentMethods:JSON.stringify(e)}}})}const Wt=function(e){let t=null;const i=()=>(null===t&&(t=new Map(e.lines.map((e=>[e.stableId,e])))),t);return{merchandiseLines:e.lines.map((e=>n(n({},te(e,i)),{},{lineComponentsSource:e.lineComponentsSource,lineComponents:e.lineComponents.map((e=>te(e,i)))})))}}({lines:gt}),$t={deliveryLines:L({shippingAddress:ze,proposedDeliveryLines:We,externalDeliveryIds:$e,destinationChanged:At,isSubmitForCompletion:i,isPointOfSale:Rt,isPointOfSaleShipToHome:Vt,negotiatedDelivery:mt.deliveryNext,filteredMerchandiseStableIds:bt,locationAddress:et,retailLocationId:D({customAttributes:mt.customAttributes}),isShippingRequired:mt.isShippingRequired,availableDeliveryAddresses:mt.availableDeliveryAddresses}),noDeliveryRequired:[],useProgressiveRates:tt,prefetchShippingRatesStrategy:null,interfaceFlow:nt,supportsSplitShipping:!0},Kt=null===(Me=mt.remoteMerchandiseDetails)||void 0===Me?void 0:Me.stableIdToShopId,Zt=Boolean(Kt&&Kt.size>0),{delivery:en,merchandise:tn,remoteNegotiations:nn}=Zt?((r,s,a,l)=>{const d=new Map;if(mt.remotePaymentDetails&&dt.length>0){var y;const{method:e}=null!==(y=dt.find((e=>"direct"===e.method.type)))&&void 0!==y?y:{};for(const[i,r]of mt.remotePaymentDetails){var v;const s=n(n({},r),{},{cardSource:null!==(v=null==e?void 0:e.cardSource)&&void 0!==v?v:null,paymentAttributes:null==e?void 0:e.paymentAttributes,billingAddress:le(t,pt,o)});d.set(i,s)}}const{delivery:h,merchandiseLines:g,remote:b}=function({deliveryInput:t,merchandiseDetails:i,paymentDetailsByShop:r,perShopSessionToken:o,perShopTaxes:s,isCompleting:a,primaryPaymentMethod:l,telemetryClient:d,perShopQueueToken:y}){const{stableIdToShopId:v,merchandiseLines:h}=i;if(null==v||0===v.size||null==o||0===o.size)return{delivery:t.deliveryTermsInput,merchandiseLines:h};const{localMerchandise:g,remoteMerchandiseByShop:b}=function(e,t){const n=[],i=new Map;return e.forEach((e=>{const r=null==e.stableId?void 0:t.get(e.stableId);if(r){const t=i.get(r)||[];i.set(r,[...t,e])}else n.push(e)})),{localMerchandise:n,remoteMerchandiseByShop:i}}(h,v),{deliveryTermsInputByShop:f,delivery:A}=function(t,i){const{deliveryLines:r}=t,o=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(t,e),s={},a=[];return new Set(i.values()).forEach((e=>{s[e]=n(n({},o),{},{deliveryLines:[]})})),r.forEach((e=>{if(e.targetMerchandiseLines.lines&&e.targetMerchandiseLines.lines.length>0){var t;const n=i.get(null!==(t=e.targetMerchandiseLines.lines[0].stableId)&&void 0!==t?t:"");n?s[n].deliveryLines.push(e):a.push(e)}else a.push(e)})),{deliveryTermsInputByShop:s,delivery:n({deliveryLines:a},o)}}(t.deliveryTermsInput,v),P=function({deliveryTermsInputByShop:e,merchandiseByShop:t,perShopSessionToken:i,perShopQueueToken:r,perShopTaxes:o,paymentDetailsByShop:s,isCompleting:a,shippingAddress:l,negotiatedMerchandiseLines:d,availableDeliveryAddresses:y,primaryPaymentMethod:v,telemetryClient:h}){if(0!==t.size)return{remoteNegotiations:Array.from(t.entries()).map((([t,g])=>{var b;const f=null==s?void 0:s.get(t),A=d.filter((({stableId:e})=>g.some((t=>t.stableId===e)))).some((e=>e.requiresShipping));return function({shopId:e,merchandiseLines:t,deliveryTermsInput:i,paymentDetails:r,sessionToken:o,queueToken:s,taxesInput:a,isCompleting:l=!1,shippingAddress:d,isShippingRequired:y,availableDeliveryAddresses:v,primaryPaymentMethod:h,telemetryClient:g}){if(!o)throw new re(`No session token for remote shop: ${e}`);if(0===i.deliveryLines.length&&t.length>0){const e=null==v?void 0:v.find((e=>u(e.address,d,["phone"])));i.deliveryLines.push({destination:(()=>{if(y)return e?{deliveryAddressReference:p(e.address)}:l?{streetAddress:c(d)}:{partialStreetAddress:c(d)}})(),selectedDeliveryStrategy:{deliveryStrategyMatchingConditions:{estimatedTimeInTransit:oe,shipments:oe},options:{}},targetMerchandiseLines:oe,deliveryMethodTypes:[y?"SHIPPING":"NONE"],expectedTotalPrice:oe,destinationChanged:!1})}const b=null!=a?a:{proposedTotalAmount:oe},{paymentDue:f,sessionId:A,paymentMethodIdentifier:P,billingAddress:M,cardSource:S,paymentAttributes:k,paymentFlexibilityTermsId:I}=null!=r?r:{},T=[];if(f&&f.amount>0&&M&&A&&h){const e=function(e,t,n,i,r,o,s){if(function(e){return"direct"===e.type}(e))return{directPaymentMethod:{sessionId:t,paymentMethodIdentifier:o,cardSource:i,paymentAttributes:r,billingAddress:{streetAddress:m(n)}}};if(function(e){return"wallet"===e.type&&"SHOP_PAY"===e.name}(e)){var a;const n=e.walletContent;return null==n?null:{walletPaymentMethod:{name:"SHOP_PAY",walletContent:{shopPayWalletContent:{sessionToken:t,billingAddress:{streetAddress:n.billingAddress},agreementToken:null!==(a=n.agreementToken)&&void 0!==a?a:void 0,paymentAttributes:n.paymentAttributes,paymentMethod:n.paymentMethod,paymentMethodIdentifier:o,addressId:n.addressId}}}}}return null==s||s.log("unexpected_remote_payment_method_type","Expected direct or Shop Pay wallet payment method for remote negotiation",{primaryPaymentMethodType:e.type}),null}(h,A,M,S,k,P,g);e&&T.push({amount:l?{value:{amount:String(f.amount),currencyCode:f.currencyCode}}:oe,paymentMethod:e})}return{shopId:e,delivery:i,merchandise:{merchandiseLines:t},payment:n(n({totalAmount:oe,paymentLines:T},M&&{billingAddress:{streetAddress:m(M)}}),I&&{paymentFlexibilityTermsId:I}),sessionToken:o,queueToken:s,taxes:b}}({shopId:t,deliveryTermsInput:null!==(b=e[t])&&void 0!==b?b:{deliveryLines:[],noDeliveryRequired:[],useProgressiveRates:!1},merchandiseLines:g,paymentDetails:f,sessionToken:null==i?void 0:i.get(t),queueToken:null==r?void 0:r.get(t),taxesInput:o.get(t),isCompleting:a,shippingAddress:l,isShippingRequired:A,availableDeliveryAddresses:y,primaryPaymentMethod:v,telemetryClient:h})}))}}({deliveryTermsInputByShop:f,merchandiseByShop:b,perShopSessionToken:o,perShopQueueToken:y,perShopTaxes:s,paymentDetailsByShop:r,isCompleting:a,shippingAddress:t.shippingAddress,negotiatedMerchandiseLines:t.negotiatedMerchandiseLines,availableDeliveryAddresses:t.availableDeliveryAddresses,primaryPaymentMethod:l,telemetryClient:d});return{delivery:A,merchandiseLines:g,remote:P}}({deliveryInput:{deliveryTermsInput:$t,shippingAddress:ze,negotiatedMerchandiseLines:null!==(r=null===(s=mt.merchandiseLines)||void 0===s?void 0:s.lines)&&void 0!==r?r:[],availableDeliveryAddresses:mt.availableDeliveryAddresses},perShopSessionToken:null===(a=mt.remoteSessionDetails)||void 0===a?void 0:a.perShopSessionToken,perShopQueueToken:null===(l=mt.remoteSessionDetails)||void 0===l?void 0:l.perShopQueueToken,perShopTaxes:Lt,merchandiseDetails:{merchandiseLines:Wt.merchandiseLines,stableIdToShopId:Kt},paymentDetailsByShop:d,primaryPaymentMethod:ut,telemetryClient:o,isCompleting:i});return{delivery:h,merchandise:n(n({},Wt),{},{merchandiseLines:g}),remoteNegotiations:b}})():{merchandise:Wt,delivery:$t,remoteNegotiations:void 0},rn=!(Zt&&0===tn.merchandiseLines.length),on=xe.enabledFlags.includes(j),sn=(null==ze?void 0:ze.countryCode)||(null==He?void 0:He.countryCode)||(null===(Se=mt.buyerIdentity)||void 0===Se?void 0:Se.countryCode),an=on?sn:null===(ke=mt.buyerIdentity)||void 0===ke?void 0:ke.countryCode,ln=n(n(n(n({checkpointData:De.current.token,sessionInput:{sessionToken:t.sessionToken},queueToken:de(Le),discounts:{lines:q({lines:Ke},Ze,o),acceptUnexpectedDiscounts:qt?mt.acceptUnexpectedDiscounts:Nt}},rn?{delivery:en}:{}),{},{deliveryExpectations:{deliveryExpectationLines:me(mt)},merchandise:tn,memberships:zt,availableRedeemables:U(Ge)},rn?{payment:{totalAmount:ae,paymentLines:V({paymentDue:mt.paymentDue,deferredTotal:mt.deferredTotal,checkoutTotal:mt.checkoutTotal,totalTaxRange:"available_total"===(null===(Ie=mt.taxes)||void 0===Ie?void 0:Ie.status)?mt.taxes.totalTaxRange:void 0},{lines:dt},m(ct),{isCompleting:i,hasSellingPlan:Ot,hasFixedSellingPlan:Bt,acceptPaymentVaulting:Fe,hasPayableDeposit:ft,useIntervalForTaxAndPayment:Pt}),billingAddress:_(dt,ct,_e.billingAddressOption.peek()),paymentFlexibilityTermsId:null===(Te=mt.paymentFlexibilityPaymentTermsTemplate)||void 0===Te?void 0:Te.id}}:{}),{},{buyerIdentity:n(n({customer:{presentmentCurrency:null===(Ce=mt.buyerIdentity)||void 0===Ce?void 0:Ce.presentmentCurrency,countryCode:an},email:Ee||void 0},Ee?{emailChanged:!vt||vt!==Ee}:{}),{},{phone:we||void 0,phoneCountryCode:Et||void 0,marketingConsent:wt,shopPayOptInPhone:{number:ze.phone||He.phone,countryCode:sn},shopUserSecureData:Ut,rememberMe:st}),tip:{tipLines:F(it)},poNumber:""===Re?null:Re},rn?{taxes:{proposedAllocations:null,proposedTotalAmount:Mt,proposedTotalIncludedAmount:St,proposedMixedStateTotalAmount:kt}}:{}),{},{note:R(mt,ot,je),localizationExtension:{fields:ce(_e)},shopPayArtifact:ie({paymentLines:dt,shopPayArtifact:Ve,shopPayRememberMeVisible:Ue,isManagedByMarketsPro:Boolean(mt.managedByMarketsPro),isApplePayInShopPayEnabled:xe.enabledFlags.includes(N),isCompleting:i})?ne(i,Ee,Ve):void 0,nonNegotiableTerms:mt.nonNegotiableTerms?B(mt.nonNegotiableTerms):null,scriptFingerprint:mt.scriptFingerprint,transformerFingerprintV2:mt.transformerFingerprintV2,optionalDuties:qe?O(qe.buyerRefusesDuties):null,attribution:Je,captcha:w(Ye),reduction:Xe,saleAttributions:Qe,alternativePaymentCurrency:E(rt),cartMetafields:at},nn?{remote:nn}:{});return r?r(ln):ln},s:he});class r extends Error{constructor(...e){super(...e),i(this,"name","UnknownMerchandiseTypeError")}}function Z(e){var t,n,i,o,s,a,l,d,u,p,c;switch(e.typename){case"ContextualizedProductVariantMerchandise":case"ProductVariantMerchandise":return{productVariantReference:{id:e.id,variantId:e.variantId,properties:ee(e.properties),sellingPlanId:null!==(t=null===(n=e.sellingPlan)||void 0===n?void 0:n.id)&&void 0!==t?t:null,sellingPlanDigest:null!==(i=null===(o=e.sellingPlan)||void 0===o?void 0:o.digest)&&void 0!==i?i:null}};case"SourceProvidedMerchandise":return{sourceProvidedMerchandise:{title:e.title,subtitle:null!==(s=e.subtitle)&&void 0!==s?s:void 0,price:{value:{amount:e.itemPrice.amount.toFixed(2),currencyCode:e.itemPrice.currencyCode}},giftCard:e.giftCard,productType:e.productType,sku:e.sku,variantId:null!==(a=e.variantId)&&void 0!==a?a:void 0,productIdV2:null!==(l=e.productId)&&void 0!==l?l:void 0,properties:ee(e.properties),requiresShipping:e.requiresShipping,vendor:null!==(d=e.vendor)&&void 0!==d?d:void 0,taxCode:null!==(u=e.taxCode)&&void 0!==u?u:void 0,taxable:null===(p=e.taxable)||void 0===p||p,taxesIncluded:e.taxesIncluded,optionalIdentifier:null!==(c=e.optionalIdentifier)&&void 0!==c?c:void 0,weight:e.weight?{value:e.weight.value,unit:e.weight.unit}:void 0}};default:throw new r(`Unrecognized merchandise type: ${e.typename}`)}}function ee(e){return e.map((e=>{switch(e.sourceType){case"MerchandisePropertyValueNull":return{name:e.name,value:e.value};case"MerchandisePropertyValueString":return{name:e.name,value:{string:e.value}};case"MerchandisePropertyValueInt":return{name:e.name,value:{integer:e.value}};case"MerchandisePropertyValueFloat":return{name:e.name,value:{float:e.value}};case"MerchandisePropertyValueBoolean":return{name:e.name,value:{boolean:e.value}};case"MerchandisePropertyValueJson":return{name:e.name,value:{json:JSON.parse(e.value)}};default:s(e)}}))}function te(e,t){var n;const i=e.totalPrice.currencyCode,r=o(i),s={stableId:e.stableId,merchandise:Z(e),quantity:{items:{value:e.quantity}},expectedTotalPrice:{value:{amount:e.totalPrice.amount.toFixed(r),currencyCode:i}}};if("parentRelationship"in e&&null!==(n=e.parentRelationship)&&void 0!==n&&n.parent){const n=t().get(e.parentRelationship.parent.stableId);n&&(s.parent=te(n,t))}return s}function ne(e,t,i){var r,o;if(!e)return i;const s=void 0!==i&&!1!==i.optIn&&n(n({},i.optIn),{},{vaultPhone:(null===(r=i.optIn)||void 0===r?void 0:r.vaultPhone)||"",vaultEmail:t?"":null===(o=i.optIn)||void 0===o?void 0:o.vaultEmail});return n(n({},i),{},{optIn:s})}function ie({paymentLines:e,shopPayArtifact:t,shopPayRememberMeVisible:n,isManagedByMarketsPro:i,isApplePayInShopPayEnabled:r,isCompleting:o}){var s;const u=Boolean(null==t||null===(s=t.shopUser)||void 0===s?void 0:s.uuid);if(!n&&!u)return!1;if(a(e))return!1;if(i&&l(e))return!1;const p=r&&o;return!(d(e,"APPLE_PAY")&&!p)&&(Boolean(t&&!1!==t.optIn)||u)}class re extends Error{constructor(...e){super(...e),i(this,"name","MissingRemoteSessionTokenError")}}const oe={any:!0};class se extends Error{constructor(...e){super(...e),i(this,"name","MissingSessionTokenError")}}const ae={any:!0};function le(e,t,n){var i;const{parts:r,source:o,facts:s}=e,a=e.current.peek(),l=r.paymentLines.peek(),d=null===(i=s.delivery)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.deliveryAddress,u=null!=d?d:r.shippingAddress.peek(),p=r.billingAddress.peek(),c=!p.address1&&s.billingAddress?s.billingAddress:p,m=r.billingAddressOption.peek(),y=a.isShippingRequired,v=Y(o)?s.requiresShipping:y,h=function(e){return e.find((e=>e.method.type===X.CreditCard||e.method.type===X.PayPal))}(l);if(h)return null==n||n.log("get_negotiation_input_vaulted_payment_billing_address_used","[getPaymentAddress] Using vaulted payment billing address"),h.method.billingAddress;const g=z(l),b="shipping"===m&&g,f=(e=>{const t=null===(e=a.buyerIdentity)||void 0===e?void 0:e.purchasingCompany;if(t){if("billing"===m&&t.location.billingAddress)return t.location.billingAddress;var n;if(b)return null!==(n=t.location.shippingAddress)&&void 0!==n?n:u}})();return f?(null==n||n.log("get_negotiation_input_company_location_address_used","[getPaymentAddress] Using company location address"),f):"billing-fact"===m?(null==n||n.log("get_negotiation_input_billing_fact_address_used","[getPaymentAddress] Using billing-fact address"),c):function(e,t){var n,i,r,o;const{parts:s}=e,a=e.current.value,l=s.paymentLines.value,d=a.runningTotal&&(null===(n=a.runningTotal)||void 0===n?void 0:n.amount)<=0,u=T(null===(i=a.merchandiseLines)||void 0===i?void 0:i.lines).some((e=>{var t;return Boolean(null===(t=e.sellingPlan)||void 0===t?void 0:t.subscriptionDetails)}));if(d&&!u&&!(null===(r=a.deferredTotal)||void 0===r?void 0:r.amount.amount))return!1;const p=S(null===(o=a.buyerIdentity)||void 0===o?void 0:o.customerProfile),c=l&&l[0];return!(!c||"wallet"!==c.method.type)&&(!p||"APPLE_PAY"!==c.method.name)&&(!!["GOOGLE_PAY","APPLE_PAY"].includes(c.method.name)||"PAYPAL_EXPRESS"===c.method.name&&W(a.paymentMethods)&&t)}(e,t)?(null==n||n.log("get_negotiation_input_wallet_billing_address_used","[getPaymentAddress] Using wallet billing address"),c):v&&b?(null==n||n.log("get_negotiation_input_shipping_address_used","[getPaymentAddress] Using shipping address"),u):(null==n||n.log("get_negotiation_input_default_billing_address_used","[getPaymentAddress] Using default billing address"),c)}function de(e){var t;return null!==(t=e.current.token)&&void 0!==t?t:null}function ue(e){if(!e)return{type:"none"};if(e.any)return{type:"any"};if(e.interval){const t=e.interval.upperBound;return{type:"interval",amount:null==t?void 0:t.amount,currencyCode:null==t?void 0:t.currencyCode}}return e.value?{type:"value",amount:e.value.amount,currencyCode:e.value.currencyCode}:{type:"unknown"}}function pe(e){if(null==e)return!0;const t=Number(e);return!Number.isFinite(t)||0===t}function ce(e){return e.localizationExtensions.peek().map((e=>{const{key:t,value:n}=e.peek();return{key:t,value:n||""}}))}function me(e){return e.deliveryExpectations&&"filled"===e.deliveryExpectations.status&&e.deliveryExpectations.deliveryExpectationLines.filter((e=>e.signedHandle)).map((e=>({signedHandle:e.signedHandle})))||[]}class ye extends Error{constructor(...e){super(...e),i(this,"name","DirectPaymentLinesMismatchError")}}function ve(e){return!!e&&("local"===e.type&&"IDEAL"===e.name||"customOnsite"===e.type)}function he(e,t){var n;return!!ve(e)||"IDEAL"===(null===(n=P.selectedPaymentMethod.value)||void 0===n?void 0:n.paymentMethod)&&(null==t?void 0:t.some(H))}}}}))}();

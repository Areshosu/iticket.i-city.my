!function(){function e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function n(n){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?e(Object(i),!0).forEach((function(e){t(n,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}))}return n}function t(e,n,t){return(n=function(e){var n=function(e){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n,t,o,i,r,a){try{var s=e[r](a),l=s.value}catch(e){return void t(e)}s.done?n(l):Promise.resolve(l).then(o,i)}System.register(["./app-legacy.CVtZXpP_.js","./useShopPaySessionTokenStorage-legacy.C9z0D7nF.js","./useShopPayParts-legacy.CeQ0YsHy.js","./useSubscribeMessenger-legacy.Yf5PyTdc.js","./NotFound-legacy.Bsa7sasp.js","./useShopPayPaymentRequiredMethod-legacy.DC5RFglA.js","./flags-legacy.62tGmLT2.js"],(function(e,t){"use strict";var i,r,a,s,l,c,u,d,g,h,p,m,f,y,_,v,w,S,b,k,P,L,O,I,U,j,C,D,A,R,x,E,T,z,V,N,B,F,M,q,$,H,W,Z,J,G,Y,K,Q,X,ee,ne,te,oe,ie,re,ae,se,le;return{setters:[e=>{i=e.i,r=e.k,a=e.B,s=e.bZ,l=e.g7,c=e.g8,u=e.g9,d=e.ga,g=e.ay,h=e.gb,p=e.gc,m=e.gd,f=e.ge,y=e.gf,_=e.gg,v=e.gh,w=e.gi,S=e.gj,b=e.gk,k=e.aN,P=e.aF,L=e.gl,O=e._,I=e.aM,U=e.eP,j=e.gm,C=e.z,D=e.a,A=e.R,R=e.gn,x=e.go,E=e.gp,T=e.em,z=e.gq,V=e.gr,N=e.a2,B=e.a3,F=e.gs,M=e.gt,q=e.S,$=e.gu,H=e.T,W=e.aT,Z=e.ab,J=e.am,G=e.fE,Y=e.aD,K=e.gv,Q=e.gw},e=>{X=e.u,ee=e.a},e=>{ne=e.f,te=e.u},e=>{oe=e.u,ie=e.a,re=e.b,ae=e.p,se=e.S},e=>{le=e.u},null,null],execute:function(){var t=document.createElement("style");t.textContent="._5Z70J{border-radius:var(--x-global-border-radius, var(--x-border-radius-base));display:flex;flex:1}.oSdnC{margin:auto}\n/*$vite$:1*/",document.head.appendChild(t),e("default",(function(){const{telemetryClient:e,shopPay:{accountSwitchState:n,hasSwitchedAccounts:t,shouldUseSessionToken:o}}=i(),r=d(),a=!!r&&K.includes(r),{refetchBuyerDetails:s,shopPayParts:l}=te(),[c]=X(),[u,g]=P(!1),h=!o||Boolean(c),p=a&&!t||Boolean(u&&l.email.value&&h),m=null==r||p;j(m);const f=Q(),{progress:y}=O();return k((()=>{c&&(t||(s(),g(!0)))}),[c,t,s]),k((()=>{n===x.Acknowledged&&g(!0)}),[n]),k((()=>{p&&(null==f||f.usable(),y("shop-pay-login-loader-complete"))}),[p,f,y]),ee({enabled:m,onTimeout:n=>{e.counter({name:"shop_pay_login_loader_loading_timeout",value:1}),e.log("shop_pay_login_loader_loading_timeout","ShopPayLoginLoader loading timeout",{timeout:n,variant:r,isUnauthenticatedVariant:a})}}),m?null:D(we,{})}));var ce=(e=>(e.Light="light",e.Dark="dark",e))(ce||{}),ue=(e=>(e.Partner="sdk_partner",e.Merchant="sdk_merchant",e))(ue||{});const de=(e="")=>{const{shopPay:n,embed:t,environment:o,i18n:{locale:S},telemetryClient:b,shop:{myshopifyDomain:k},source:{checkoutSessionIdentifier:P},mobileCheckoutSdk:L}=i(),{hasSwitchedAccounts:O}=n,{transaction_params:I,authorization:U}=a(),j=s(),C=l(),{skipAutomaticCustomerLoginAttempt:D}=c(),A=u(),R=d(),x=o.services.payShopifyCom.url,E=function(){const{shop:{id:e}}=i();return r((()=>{const n=e.split("/").pop();if(!n)return;const t=parseInt(n,10);return isNaN(t)?void 0:t}),[e])}(),T=g(h),z=g("shop-accounts-client-uuid"),V=p(),N=Boolean(t);return r((()=>{var t,o,i;if(!P)throw new m({groupingHash:"ShopPayCheckoutIdentifierMissingError::LoginFrame"});const{origin:r,flowVersion:a,flow:s}=function(e){return _(e)?{origin:e.stripeConfig.isStripeExpress?v.ShopPayExternalWallet:v.PaymentRequest,flowVersion:w()?"iframe":void 0,flow:"payment_request"}:{origin:"c1_login",flowVersion:void 0,flow:void 0}}(n),l=new URLSearchParams(window.location.search),c=null!==(t=null!==(o=null!==(i=l.get("shop_client_uuid"))&&void 0!==i?i:l.get("client_uuid"))&&void 0!==o?o:T)&&void 0!==t?t:z;N&&!c&&b.log("shop_pay_login_seamless_missing_client_uuid","[ShopPayLoginFrame] Embedded checkout missing shop_client_uuid for Login Seamless.");const u=new URLSearchParams({flow:null!=s?s:"",locale:S,origin:r,isPointOfSale:String(C),transaction_params:null!=I?I:"",flow_version:null!=a?a:"",shopify_domain:k,checkout_token:P,shop_id:String(E),analytics_trace_id:e,shop_pay_button_variant:n.logoBrand,shop_pay_new_signup_login_variant:R});c&&u.set("client_uuid",c);const d=l.get("login_hint");d&&u.set("login_hint",d),!D&&null!=j&&j.email&&u.set("storefront_account_email",j.email),A&&(u.set(f,L.variant.isPartner()?ue.Partner:ue.Merchant),u.set(y,ce.Dark)),O||u.set("authorization",null!=U?U:""),V(u,l);const g=new URL("/pay/authentication/login-seamless",x);return g.search=u.toString(),{origin:r,frameUrl:g.href}}),[e,V,U,P,null==j?void 0:j.email,O,x,A,N,C,S,k,L,T,z,E,n,R,D,b,I])},ge=(e="")=>{const{shopPay:n,environment:t,i18n:{locale:o},shop:{myshopifyDomain:a},source:{checkoutSessionIdentifier:l}}=i(),u=s(),{skipAutomaticCustomerLoginAttempt:d}=c();return r((()=>{if(!l)return{origin:"c1_login",frameUrl:""};const{origin:i,flowVersion:r}=function(e){return _(e)?{origin:e.stripeConfig.isStripeExpress?v.ShopPayExternalWallet:v.PaymentRequest,flowVersion:"iframe"}:{origin:"c1_login",flowVersion:"iframe"}}(n),s=new URLSearchParams(window.location.search),c=new URLSearchParams;c.set("locale",o),c.set("analytics_trace_id",e),c.set("origin",i),c.set("checkout_token",l),c.set("flow","pay_checkout_login"),c.set("flow_version",null!=r?r:""),c.set("target_origin",window.location.origin),c.set("storefront_domain",a),c.set("layout","full");const g=s.get("login_hint");g?c.set("login_hint",g):!d&&null!=u&&u.email&&c.set("login_hint",u.email);const h=new URL("/accounts/login/embedded",t.services.shopServer.url);return h.search=c.toString(),{origin:i,frameUrl:h.href}}),[e,l,null==u?void 0:u.email,t.services.shopServer.url,o,a,n,d])},he=(e="")=>{const{i18n:{locale:n},shop:{myshopifyDomain:t},source:{checkoutSessionIdentifier:o}}=i(),l=s(),{redirect_url:c}=a();return r((()=>{if(!o)return{origin:"c1_login",frameUrl:""};const i=new URLSearchParams;i.set("client_id",""),i.set("redirect_uri",`https://${t}/services/login_with_shop/callback`),i.set("scope","openid email"),i.set("response_type","code"),i.set("state",function(){const e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e,(e=>e.toString(36))).join("")}()),i.set("storefront_domain",t),i.set("locale",n),i.set("analytics_trace_id",e),i.set("origin","c1_login"),i.set("checkout_token",o),i.set("flow","pay_checkout_login"),i.set("target_origin",`https://${t}`),i.set("ux_mode","iframe"),i.set("layout","full"),c&&i.set("checkout_redirect_url",c);const r=new URLSearchParams(window.location.search).get("login_hint");r?i.set("login_hint",r):null!=l&&l.email&&i.set("login_hint",l.email);try{const e=new URL("/services/login_with_shop/authorize",`https://${t}`);return e.search=i.toString(),{origin:"c1_login",frameUrl:e.href}}catch(a){return{origin:"c1_login",frameUrl:""}}}),[e,o,null==l?void 0:l.email,n,t,c])},pe=e=>{switch(e){case b.OAuth:return{serverDrivenAuth:!0,variant:"oauth"};case b.Embedded:return{serverDrivenAuth:!0,variant:"embedded"};case b.Control:default:return{serverDrivenAuth:!1,variant:"seamless"}}},me={LoginIframe:"_5Z70J"},fe="shop-pay-login-iframe",ye="100%";function _e(){const[e,n]=P(!0),t=L(),{progress:s}=O(),{i18n:l}=i(),u=I(null),{exchangeSessionTokenForCookie:g}=oe(),{extendBuyerIdentity:h}=ie(),{sessionStorageEmail:p,startEmailOnlySignUp:m,setSkipAutomaticCustomerLoginAttempt:f,setSharedHCaptchaToken:y}=c(),_=r((()=>U()),[]),v=d(),{iframeOrigin:w,iframeUrl:b,serverDrivenAuth:E,source:T,variant:z}=function(e=""){const n={seamless:de(e),embedded:ge(e),oauth:he(e)},t=S(),{serverDrivenAuth:o,variant:i}=pe(t),{frameUrl:a,origin:s}=n[i];return{iframeOrigin:r((()=>{try{return new URL(a).origin}catch(e){return""}}),[a]),serverDrivenAuth:o,source:s,iframeUrl:a,variant:i}}(_),V=E?400:250,[N,B]=P(V),{telemetryClient:F,shopPay:{accountSwitchState:M,acknowledgeAccountSwitch:q}}=i(),{checkout_as_guest_url:$}=a(),{replaceShopPayInHistory:H}=le();j(e);const W=C((()=>{var e,n;ae(null==u?void 0:u.current,{action:se.Ready}),null!==(e=u.current)&&void 0!==e&&null!==(e=e.contentDocument)&&void 0!==e&&e.body&&(null===(n=R(u.current.contentDocument.body))||void 0===n||n.focus())}),[]),[,Z]=X(),J=C(function(){var e,n=(e=function*(e,n){if(n)Z(n);else if(e){const n=yield g({token:e,origin:T,analytics_trace_id:_});n.ok||(F.log("shop_pay_login_frame_session_token_exchange_failed","exchangeSessionTokenForCookie request failed",{status:n.status}),n.status>=500&&H($))}yield h(),f(!1),M!==x.Idle&&q(),s("shop-pay-login-success")},function(){var n=this,t=arguments;return new Promise((function(i,r){var a=e.apply(n,t);function s(e){o(a,i,r,s,l,"next",e)}function l(e){o(a,i,r,s,l,"throw",e)}s(void 0)}))});return function(e,t){return n.apply(this,arguments)}}(),[f,s,Z,g,T,_,h,$,H,F,q,M]),G=C((e=>{B(e)}),[]),Y=C((e=>{m(e),f(!1),s("shop-pay-email-only-redirect")}),[s,m,f]),K=C((e=>{y(e)}),[y]);return k((()=>{p&&t>0&&(f(!1),s("shop-pay-session-email-auto-progress"))}),[p,s,f,t]),re({onLoaded:W,onLoggedIn:J,onResized:G,onRedirectUserWithEmailOnly:Y,onShareCaptchaToken:K,skip:!("seamless"===z)}),function({iframeOrigin:e,onLoggedIn:n,telemetryClient:t,skip:o=!1}){k((()=>{if(o)return;const i=o=>{if(o.origin===e&&o.data&&"object"==typeof o.data&&"redirect_url_on_complete"===o.data.type&&o.data.postSignInUrl)try{const e=new URL(o.data.postSignInUrl).searchParams.get("token");e&&(null==n||n(e))}catch(i){null==t||t.log("shop_pay_embedded_login_url_parse_error","Failed to parse redirect URL")}};return window.addEventListener("message",i),()=>window.removeEventListener("message",i)}),[n,t,e,o])}({iframeOrigin:w,onLoggedIn:e=>J(e),telemetryClient:F,skip:!("embedded"===z)}),v&&b?D(A,{children:D("iframe",{ref:u,id:fe,title:l.translate("shop_pay.verification.title"),src:b,onLoad:()=>n(!1),height:N,width:ye,className:me.LoginIframe,allow:"publickey-credentials-get *"})}):null}const ve={ShopPayLogin:"oSdnC"};function we(){!function(){E(ne);const{redirect_source:e}=a(),{monorail:t,source:o,checkout:r,shop:s}=i(),{checkoutSessionIdentifier:c="checkout_identifier_undefined"}=o,{pageLoadId:u}=T(o,r,s),d=z(V.SHOP_PAY_LOGIN),g=l();N({stage:B.Complete,id:"ShopPayLogin"}),k((()=>{F()&&t.record({schemaId:"shop_app_page_load/9.0",payload:n(n({},T(o,r,s)),{},{platform:"web",locale:navigator.language,userToken:M("_shopify_y")||"",webSessionToken:M("_shopify_s")||"",pageType:"pay_checkout_login",pageValue:c})}),t.record({schemaId:"shopify_pay_page_load/2.6",payload:n(n({},T(o,r,s)),{},{pageType:"checkout_login",clientTimestampMs:Date.now(),pageLoadId:u,redirectSource:e})}),g&&(null==t||t.record({schemaId:"retail_shop_pay/2.0",payload:d}))}),[u,t,o,r,s,e,d,g,c])}();const{i18n:e,monorail:t,source:o,checkout:s,shop:c,shopPay:u}=i(),d="shopPayExternal"===o.type,g=r((()=>{const e="undefined"!=typeof document&&""!==document.referrer,n="undefined"!=typeof window&&window.history&&window.history.length>1;return e||n}),[]),h=q.default("block").when({viewportInlineSize:{min:"medium"}},"none"),p=!d&&g;return D("div",{children:[D($,{padding:"none",dividerDisplay:h,children:D(H,{padding:q.default("none").when({viewportInlineSize:{min:"small"}},["none","none","large300","none"]),maxInlineSize:q.default(432).when({viewportInlineSize:{min:"small"}},425),className:W(ve.ShopPayLogin),children:D($,{padding:"none",border:q.when({viewportInlineSize:{min:"small"}},"base"),borderRadius:q.when({viewportInlineSize:{min:"small"}},"base"),hideDivider:!0,children:D(_e,{})})})}),u.visibility.showUnauthedOrderSummary&&D(Z,{section:"summary",children:D(J,{above:"small",children:D($,{hideDivider:!0,children:D(G,{})})})}),p?D(H,{inlineAlignment:"center",children:D(Y,{onClick:()=>{t.record({schemaId:"shopify_pay_login_page_ui_interaction/1.2",payload:n(n({},T(o,s,c)),{},{action:"back_button_to_referrer"})}),history.back()},accessibilityLabel:e.translate("shop_pay.checkout.back"),textDecoration:"none",children:e.translate("shop_pay.checkout.back")})}):null]})}}}}))}();

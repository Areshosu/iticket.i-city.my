!function(){function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function t(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?e(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(e,t,o){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}System.register(["./app-legacy.CVtZXpP_.js"],(function(e,i){"use strict";var n,r,l,a,u,s,d,c,p,v,h,m,k,f,y,b,g,C,S,A,P,I,D,E;return{setters:[e=>{n=e.bb,r=e.gt,l=e.h1,a=e.h2,u=e.h3,s=e.i,d=e.h4,c=e.n,p=e.h5,v=e.bw,h=e.ay,m=e.cc,k=e.h6,f=e.h7,y=e.h8,b=e.k,g=e.dj,C=e.z,S=e.h9,A=e.ha,P=e.hb,I=e.hc,D=e.hd,E=e.he}],execute:function(){e("default",(function(){var e,t,o;const{telemetryClient:i,environment:n,i18n:{locale:r},monorail:l,shop:a,source:u,shopPay:w}=s(),N=w.isActive?"trekkie-checkout-one-shop-app":"trekkie-checkout-one",L=u.checkoutSessionIdentifier||u.sourceId;let j=void 0===(null===(e=a.theme)||void 0===e?void 0:e.id)||null===(null===(t=a.theme)||void 0===t?void 0:t.id)?void 0:parseInt(a.theme.id,10);j&&j>Number.MAX_SAFE_INTEGER&&(j=void 0);const W=null===(o=a.theme)||void 0===o?void 0:o.cityhash,F=d(),{email:B,phone:x,shippingAddress:z}=c(),H=p(),{value:U}=v(),V=h("api-client-id"),q=h("api-client-id"),{currentPage:G}=m(),$=G&&["onePage"].includes(G.id),X=k(),J=f(),{value:K}=y(),Q=K,Y=b((()=>({})),[]),Z=g(),ee=C((e=>{var t;e?(null===(t=Z.value)||void 0===t?void 0:t.defaultAttributes)!==(null==e?void 0:e.defaultAttributes)&&Z.setValue({defaultAttributes:null==e?void 0:e.defaultAttributes}):i.error(new S("Trekkie is not available"))}),[i,Z]),te=b((()=>{var e,t;const o=null===W?void 0:W,i=F.current.fields.buyerIdentity.peek(),u={facebookCapiEnabled:a.facebookCapiEnabled,source:N,customerId:A(null==i||null===(e=i.customerProfile)||void 0===e?void 0:e.id),cartApiClientId:V,apiClientId:q},s=`${n.services.trekkie.url}/${(null===(t=a.trekkieLoadConfiguration)||void 0===t?void 0:t.assetPath)||"s/trekkie.storefront.min.js"}`;return X?null:function(e,t){return new O(e,t)}({shop:a,checkoutToken:L,locale:r,analyticsConfig:Y,sourceUrl:s,themeId:j,themeCityHash:o,monorail:l,monorailRegion:"shop_domain",s2s:u},ee)}),[a,L,r,Y,j,W,l,ee,F,V,q,N,X,n.services.trekkie.url]),oe=C((e=>{const{title:t,page:o}=M(e);t&&o&&(null==te||te.page(t,{path:o}))}),[te]),ie=C((e=>{const{title:t,page:o}=M(e);if(!t||!o)return;const i={name:t,path:o};null==te||te.track(T.CheckoutOnePageView,i,void 0,void 0,{shopifyEmitted:!0})}),[te]),ne=b((()=>{let e={amount:void 0,currencyCode:void 0};return H&&"filled"===(null==U?void 0:U.status)&&U.lines.forEach((t=>{if("available"===t.status){const o=t.selectedDeliveryMethodHandle;if(o){const i=t.methods.filter((e=>e.handle===o&&void 0!==e.costAfterDiscounts));e=i.reduce(((e,t)=>{const o=void 0===e.amount?0:e.amount;return e.amount=o+t.costAfterDiscounts.amount,e.currencyCode=t.costAfterDiscounts.currencyCode,e}),e)}}})),e}),[U,H]),re=C((()=>{var e,t;const o=F.current.fields.subtotal.peek(),i=F.current.fields.subtotalAfterMerchandiseDiscounts.peek(),n=F.current.fields.remoteTotalDetails.peek(),r=F.current.fields.merchandiseLines.peek(),l=F.current.fields.remoteMerchandiseDetails.peek(),a=P(null!==(e=null==r?void 0:r.lines)&&void 0!==e?e:[],l),u=I(null!==(t=null==r?void 0:r.lines)&&void 0!==t?t:[],l),s={step:1,products:_(a),currency:null==o?void 0:o.currencyCode,revenue:null==o?void 0:o.amount,subtotalAfterMerchandiseDiscounts:null==i?void 0:i.amount};null==te||te.track(T.StartedOrder,s,void 0,void 0,{shopifyEmitted:!0}),Q&&R({remoteTotalDetails:n,remoteMerchandiseLinesByShopId:u,emitRemoteEventForShop:({remoteTotals:e,remoteMerchandiseLines:t})=>{var o,i,n;const r={step:1,products:t?_(t):[],currency:null==e||null===(o=e.subtotal)||void 0===o?void 0:o.currencyCode,revenue:null==e||null===(i=e.runningTotal)||void 0===i?void 0:i.amount,subtotalAfterMerchandiseDiscounts:null==e||null===(n=e.subtotal)||void 0===n?void 0:n.amount};null==te||te.track(T.StartedOrderRemote,r,void 0,void 0,{shopifyEmitted:!0})}})}),[te,F,Q]),le=C((()=>{var e,t;const o=F.current.fields.subtotal.peek(),i=F.current.fields.subtotalAfterMerchandiseDiscounts.peek(),n=F.current.fields.remoteTotalDetails.peek(),r=F.current.fields.merchandiseLines.peek(),l=F.current.fields.remoteMerchandiseDetails.peek(),a=P(null!==(e=null==r?void 0:r.lines)&&void 0!==e?e:[],l),u=I(null!==(t=null==r?void 0:r.lines)&&void 0!==t?t:[],l),s={step:1,products:_(a),currency:null==o?void 0:o.currencyCode,revenue:null==o?void 0:o.amount,subtotalAfterMerchandiseDiscounts:null==i?void 0:i.amount};null==te||te.track(T.StartedOrderOncePerCheckout,s,void 0,void 0,{shopifyEmitted:!0}),Q&&R({remoteTotalDetails:n,remoteMerchandiseLinesByShopId:u,emitRemoteEventForShop:({remoteTotals:e,remoteMerchandiseLines:t})=>{var o,i,n;const r={step:1,products:t?_(t):[],currency:null==e||null===(o=e.subtotal)||void 0===o?void 0:o.currencyCode,revenue:null==e||null===(i=e.runningTotal)||void 0===i?void 0:i.amount,subtotalAfterMerchandiseDiscounts:null==e||null===(n=e.subtotal)||void 0===n?void 0:n.amount};null==te||te.track(T.StartedOrderOncePerCheckoutRemote,r,void 0,void 0,{shopifyEmitted:!0})}})}),[te,F,Q]),ae=C((()=>{var e,t,o,i,n,r,l,a,u;if(!H)return;if(J.shouldPrevent())return;const s=F.current.fields.merchandiseLines.peek(),d=(null==s?void 0:s.lines)&&_(null==s?void 0:s.lines),c=H.purchaseOrder,p=A(H.orderIdentity.id),v=null==p?void 0:p.toString(),h=c.billingAddress,m=F.current.fields.buyerIdentity.peek(),k=null==m?void 0:m.customerProfile;let f=null==k?void 0:k.firstName,y=null==k?void 0:k.lastName;y||(f=null==h?void 0:h.firstName,y=null==h?void 0:h.lastName);const b=F.current.fields.total.peek(),g=F.current.fields.subtotal.peek(),C=F.current.fields.subtotalAfterMerchandiseDiscounts.peek(),S=D(F),P=F.current.fields.contactInfo.peek(),I=F.current.fields.discountLines.peek(),E=(null==I?void 0:I.lines.filter((e=>"code"===e.discount.type)).map((e=>e.discount.title)))||[],w=(null===(e=H.analytics)||void 0===e?void 0:e.checkoutCompletedEventId)||void 0,O=(null===(t=H.analytics)||void 0===t?void 0:t.emitConversionEvent)||!1;null==te||te.track(T.CompletedOrder,{customerEventData:{customer:{firstName:f,lastName:y,emailAddress:null!==(o=null==k?void 0:k.email)&&void 0!==o?o:null==P?void 0:P.email,phoneNumber:null!==(i=null==k?void 0:k.phone)&&void 0!==i?i:null==P?void 0:P.phone},address:{city:null==h?void 0:h.city,province:null==h?void 0:h.zoneCode,country:null==h?void 0:h.countryCode,zip:null==h?void 0:h.postalCode}},orderId:p,orderName:v,products:d,total:null!==(n=null==b?void 0:b.amount)&&void 0!==n?n:0,currency:null==b?void 0:b.currencyCode,revenue:null!==(r=null==g?void 0:g.amount)&&void 0!==r?r:0,subtotalAfterMerchandiseDiscounts:null!==(l=null==C?void 0:C.amount)&&void 0!==l?l:0,coupon:E[0],tax:null!==(a=null==S?void 0:S.amount)&&void 0!==a?a:0,shipping:null!==(u=ne.amount)&&void 0!==u?u:0},w,O,{shopifyEmitted:!0}),J.markAsEmitted()}),[H,F,te,ne.amount,J]),ue=C((()=>{const e=F.current.fields.runningTotal.peek(),t=F.current.fields.subtotalAfterMerchandiseDiscounts.peek(),o=F.current.fields.remoteTotalDetails.peek(),i={currency:null==e?void 0:e.currencyCode,total:null==e?void 0:e.amount,subtotalAfterMerchandiseDiscounts:null==t?void 0:t.amount};null==te||te.track(T.AddedPayment,i,void 0,void 0,{shopifyEmitted:!0}),Q&&R({remoteTotalDetails:o,emitRemoteEventForShop:({remoteTotals:e})=>{var t,o,i;const n={currency:null==e||null===(t=e.runningTotal)||void 0===t?void 0:t.currencyCode,total:null==e||null===(o=e.runningTotal)||void 0===o?void 0:o.amount,subtotalAfterMerchandiseDiscounts:null==e||null===(i=e.subtotal)||void 0===i?void 0:i.amount};null==te||te.track(T.AddedPaymentRemote,n,void 0,void 0,{shopifyEmitted:!0})}})}),[te,F,Q]),se=C((()=>{const{title:e,page:t}=M("/information"),o={name:e,path:t};null==te||te.track(T.CheckoutContactPageStarted,o,void 0,void 0,{shopifyEmitted:!0})}),[te]),de=C((()=>{const e=B.peek(),t=x.peek(),o=F.current.fields.subtotalAfterMerchandiseDiscounts.peek(),i=F.current.fields.remoteTotalDetails.peek(),n={email:e,phone:t,subtotalAfterMerchandiseDiscounts:null==o?void 0:o.amount};null==te||te.track(T.CheckoutContactInfoSubmitted,n,void 0,void 0,{shopifyEmitted:!0}),Q&&R({remoteTotalDetails:i,emitRemoteEventForShop:({remoteTotals:o})=>{var i;const n={email:e,phone:t,subtotalAfterMerchandiseDiscounts:null==o||null===(i=o.subtotal)||void 0===i?void 0:i.amount};null==te||te.track(T.CheckoutContactInfoSubmittedRemote,n,void 0,void 0,{shopifyEmitted:!0})}})}),[te,B,x,F,Q]),ce=C((()=>{const e=z.peek(),t=F.current.fields.subtotalAfterMerchandiseDiscounts.peek(),o=F.current.fields.remoteTotalDetails.peek(),i={city:null==e?void 0:e.city,country:null==e?void 0:e.countryCode,phone:null==e?void 0:e.phone,province:null==e?void 0:e.zoneCode,postalCode:null==e?void 0:e.postalCode,firstName:null==e?void 0:e.firstName,lastName:null==e?void 0:e.lastName,address1:null==e?void 0:e.address1,address2:null==e?void 0:e.address2,subtotalAfterMerchandiseDiscounts:null==t?void 0:t.amount};null==te||te.track(T.CheckoutAddressInfoSubmitted,i,void 0,void 0,{shopifyEmitted:!0}),Q&&R({remoteTotalDetails:o,emitRemoteEventForShop:({remoteTotals:t})=>{var o;const i={city:null==e?void 0:e.city,country:null==e?void 0:e.countryCode,phone:null==e?void 0:e.phone,province:null==e?void 0:e.zoneCode,postalCode:null==e?void 0:e.postalCode,firstName:null==e?void 0:e.firstName,lastName:null==e?void 0:e.lastName,address1:null==e?void 0:e.address1,address2:null==e?void 0:e.address2,subtotalAfterMerchandiseDiscounts:null==t||null===(o=t.subtotal)||void 0===o?void 0:o.amount};null==te||te.track(T.CheckoutAddressInfoSubmittedRemote,i,void 0,void 0,{shopifyEmitted:!0})}})}),[te,z,F,Q]),pe=C((()=>{const{title:e,page:t}=M("/shipping"),o={name:e,path:t};null==te||te.track(T.CheckoutShippingPageStarted,o,void 0,void 0,{shopifyEmitted:!0})}),[te]),ve=C((()=>{const e=F.current.fields.runningTotal.peek(),t=F.current.fields.subtotalAfterMerchandiseDiscounts.peek(),o=F.current.fields.remoteTotalDetails.peek(),i={total:null==e?void 0:e.amount,currency:null==e?void 0:e.currencyCode,subtotalAfterMerchandiseDiscounts:null==t?void 0:t.amount};null==te||te.track(T.CheckoutShippingInfoSubmitted,i,void 0,void 0,{shopifyEmitted:!0}),Q&&R({remoteTotalDetails:o,emitRemoteEventForShop:({remoteTotals:e})=>{var t,o,i;const n={total:null==e||null===(t=e.runningTotal)||void 0===t?void 0:t.amount,currency:null==e||null===(o=e.runningTotal)||void 0===o?void 0:o.currencyCode,subtotalAfterMerchandiseDiscounts:null==e||null===(i=e.subtotal)||void 0===i?void 0:i.amount};null==te||te.track(T.CheckoutShippingInfoSubmittedRemote,n,void 0,void 0,{shopifyEmitted:!0})}})}),[te,F,Q]),he=C((()=>{const{title:e,page:t}=M("/payment"),o={name:e,path:t};null==te||te.track(T.CheckoutPaymentPageStarted,o,void 0,void 0,{shopifyEmitted:!0})}),[te]);return E(C((e=>{Z.value.defaultAttributes&&"page_view"===e.type&&oe(e.url)}),[Z,oe])),E(C((e=>{Z.value.defaultAttributes&&"initiate_checkout"===e.type&&re()}),[Z,re])),E(C((e=>{Z.value.defaultAttributes&&"initiate_checkout_once_per_checkout"===e.type&&le()}),[Z,le])),E(C((e=>{Z.value.defaultAttributes&&"complete_checkout"===e.type&&ae()}),[Z,ae])),E(C((e=>{Z.value.defaultAttributes&&"add_payment_info"===e.type&&ue()}),[Z,ue])),E(C((e=>{Z.value.defaultAttributes&&"one_page_checkout_page_view"===e.type&&ie(e.url)}),[Z,ie])),E(C((e=>{Z.value.defaultAttributes&&("section_interaction"===e.type&&$&&("contact"===e.section?se():"payment"===e.section&&(ve(),he())),"section_complete"===e.type&&("contact"===e.section?de():"deliveryAddress"===e.section&&ce()),"shipping_methods_filled"===e.type&&$&&pe(),"page_submit"!==e.type||"shipping"!==e.page||$||ve())}),[Z.value.defaultAttributes,$,se,ve,he,de,ce,pe])),null}));const i="checkout";class w extends Error{constructor(...e){super(...e),o(this,"name","TrekkieError")}}class O{get trekkie(){var e;return null===(e=this.analyticsWindow)||void 0===e?void 0:e.trekkie}set trekkie(e){if(!this.analyticsWindow)throw new w("AnalyticsWindow is not set.");this.analyticsWindow.trekkie=e}get shopifyAnalytics(){return this.analyticsWindow.ShopifyAnalytics}set shopifyAnalytics(e){if(!this.analyticsWindow)throw new w("AnalyticsWindow is not set.");this.analyticsWindow.ShopifyAnalytics=e}constructor({shop:e,checkoutToken:s="",locale:d,analyticsConfig:c,sourceUrl:p,themeId:v,themeCityHash:h,monorail:m,s2s:k,monorailRegion:f},y){var b,g,C;if(o(this,"libraryLoaded",!1),o(this,"analyticsWindow",void 0),o(this,"trekkieLoadedCallback",void 0),this.trekkieLoadedCallback=y,this.analyticsWindow=window,this.trekkie=(null===(b=this.analyticsWindow.ShopifyAnalytics)||void 0===b?void 0:b.lib)||this.analyticsWindow.trekkie||[],null!==(g=this.trekkie)&&void 0!==g&&g.integrations)return this.libraryLoaded=!0,void this.trekkieLoadedCallback(null===(C=this.analyticsWindow)||void 0===C||null===(C=C.ShopifyAnalytics)||void 0===C||null===(C=C.lib)||void 0===C?void 0:C.trekkie);const S=parseInt(n(e.id),10),A=new Set([l,a,u]),P=e.enabledFlags.filter((e=>A.has(e)));this.trekkie.ready((()=>{var e;this.libraryLoaded||(this.libraryLoaded=!0,this.shopifyAnalytics=t(t({},this.shopifyAnalytics),{},{lib:this.trekkie}),this.trekkieLoadedCallback(null===(e=this.analyticsWindow)||void 0===e||null===(e=e.ShopifyAnalytics)||void 0===e||null===(e=e.lib)||void 0===e?void 0:e.trekkie))})),this.trekkie.load=t=>{var o;this.trekkie.config=t;const{assetPath:n,sriHash:r}=e.trekkieLoadConfiguration,l=n&&r,a=document.getElementsByTagName("script")[0],u=document.createElement("script");u.type="text/javascript",u.onerror=function(){var e;const t=document.createElement("script");t.type="text/javascript",t.onerror=function(){const e={schemaId:"trekkie_checkout_load_errors/1.1",payload:{appName:i,shopId:S,themeId:v,contextUrl:window.location.href,sourceUrl:p}};m.record(e)},t.async=!0,t.src=p,l&&(t.setAttribute("integrity",r),t.setAttribute("crossorigin","anonymous")),null==a||null===(e=a.parentNode)||void 0===e||e.insertBefore(t,a)},u.async=!0,u.src=p,l&&(u.setAttribute("integrity",r),u.setAttribute("crossorigin","anonymous")),null==a||null===(o=a.parentNode)||void 0===o||o.insertBefore(u,a)};const I={appName:i,development:!1,defaultAttributes:{shopId:S,isMerchantRequest:!!r("_ab")||null,themeId:v,themeCityHash:h,contentLanguage:d,currency:e.currencyCode,checkoutToken:s},isServerSideCookieWritingEnabled:!0,enabledBetaFlags:P};f&&(I.monorailRegion=f),this.trekkie.load(t(t({Trekkie:I},c),{},{"Session Attribution":{},S2S:k}))}page(e="",t={},o){var i;null===(i=this.trekkie)||void 0===i||i.page(e,t,o)}track(e,t,o,i,n){var r;null===(r=this.trekkie)||void 0===r||r.track(e,t,o,i,n)}}var T=(e=>(e.StartedOrder="Started Order",e.StartedOrderRemote="Started Order Remote",e.StartedOrderOncePerCheckout="Started Order Once Per Checkout",e.StartedOrderOncePerCheckoutRemote="Started Order Once Per Checkout Remote",e.CompletedOrder="Completed Order",e.AddedPayment="Added Payment",e.AddedPaymentRemote="Added Payment Remote",e.CheckoutContactPageStarted="Checkout Contact Step Started",e.CheckoutContactInfoSubmitted="Checkout Contact Info Submitted",e.CheckoutContactInfoSubmittedRemote="Checkout Contact Info Submitted Remote",e.CheckoutAddressInfoSubmitted="Checkout Address Info Submitted",e.CheckoutAddressInfoSubmittedRemote="Checkout Address Info Submitted Remote",e.CheckoutShippingPageStarted="Checkout Shipping Step Started",e.CheckoutShippingInfoSubmitted="Checkout Shipping Info Submitted",e.CheckoutShippingInfoSubmittedRemote="Checkout Shipping Info Submitted Remote",e.CheckoutPaymentPageStarted="Checkout Payment Step Started",e.CheckoutOnePageView="Checkout One Page View",e))(T||{});function R({remoteTotalDetails:e,remoteMerchandiseLinesByShopId:t,emitRemoteEventForShop:o}){if(e)for(const[n,r]of e.perShopRemoteTotals.entries())if(t){var i;o({remoteTotals:r,remoteMerchandiseLines:null!==(i=null==t?void 0:t.get(n))&&void 0!==i?i:[]})}else o({remoteTotals:r})}function M(e){switch(e){case"/":case"/information":return{title:"Checkout - Contact Information",page:"/checkout/contact_information"};case"/shipping":return{title:"Checkout - Shipping",page:"/checkout/shipping"};case"/payment":return{title:"Checkout - Payment",page:"/checkout/payment"};case"/review":return{title:"Checkout - Review",page:"/checkout/review"};case"/processing":return{title:"Checkout - Processing",page:"/checkout/processing"};case"/thank-you":return{title:"Checkout - Receipt",page:"/checkout/thank_you"};case"/stock-problems":return{title:"Checkout - Stock problems",page:"/checkout/stock_problems"};case"/error":return{title:"Checkout - Error",page:"/checkout/error"};case"/no-address-location":return{title:"Checkout - No Address Location",page:"/checkout/no_address_location"};case"/shoppay_login":return{title:"ShopPay - Login",page:"/shop.app/pay/login"};case"/shoppay":return{title:"ShopPay - Payment",page:"/shop.app/pay/payment"};default:return{title:null,page:null}}}function _(e){return null==e?void 0:e.map((e=>{var t,o;const i=e.lineAllocations.reduce(((e,t)=>(t.allocations.filter((e=>"code"===e.discountDetails.discount.type)).forEach((t=>{t.amount.amount>e.amount&&(e.amount=t.amount.amount,e.code=t.discountDetails.title)})),e)),{code:void 0,amount:0});return{variantId:A(e.variantId),productId:A(e.productId),productGid:e.productId,category:e.productType,coupon:i.code,currency:null===(t=e.itemPrice)||void 0===t?void 0:t.currencyCode,name:e.title,price:null===(o=e.itemPrice)||void 0===o?void 0:o.amount,quantity:e.quantity,brand:e.vendor,variant:e.subtitle,sku:e.sku}}))}}}}))}();
